ARG BASE=centos
ARG VERSION=latest

FROM ${BASE}:${VERSION} as build

RUN dnf --disablerepo '*' --enablerepo extras swap centos-linux-repos centos-stream-repos -y && \
    dnf distro-sync -y && \
#    dnf update -y && \
    #cd /etc/yum.repos.d/ && \
#    sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-* && \
#    sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-* && \
#    dnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm && \
#    dnf install -y https://download1.rpmfusion.org/free/el/rpmfusion-free-release-8.noarch.rpm && \
#    dnf -y install epel-release && \
#    dnf -y install https://download1.rpmfusion.org/free/el/rpmfusion-free-release-8.noarch.rpm && \
    dnf install vlc -y
#    dnf search vlc

RUN useradd -m vlcuser

# WORKDIR /stream

COPY fragment.mp4 .

#FROM debian:${VERSION} as runtime

#COPY --from=build . .

# ENTRYPOINT /stream
CMD su vlcuser -c "cvlc -vvv "fragment.mp4" --play-and-exit --sout '#standard{access=http,mux=ts,dst=0.0.0.0:8080}'"